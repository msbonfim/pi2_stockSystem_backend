{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static "admin/css/changelists.css" %}">       
  {% if cl.formset %}
    <link rel="stylesheet" href="{% static "admin/css/forms.css" %}">
  {% endif %}
  {% if cl.formset or action_form %}
    <script src="{% url 'admin:jsi18n' %}"></script>
  {% endif %}
  {{ media.css }}
  {% if not actions_on_top and not actions_on_bottom %}
    <style>
      #changelist table thead th:first-child {width: inherit}
    </style>
  {% endif %}
  <style>
    /* FOR√áAR oculta√ß√£o da sidebar de filtros */
    #content-related {
      display: none !important;
      visibility: hidden !important;
      width: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
      position: absolute !important;
      left: -9999px !important;
    }
    /* Filtros inline aparecem ap√≥s a busca */
    #changelist-filter.inline-filters {
      margin-top: 0.75rem !important;
      padding-top: 0.75rem !important;
      border-top: 1px solid #e2e8f0 !important;
      width: 100% !important;
      display: flex !important;
      flex-wrap: wrap !important;
      gap: 0.75rem !important;
      align-items: center !important;
      background: transparent !important;
      border: none !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
      box-shadow: none !important;
    }
    #changelist-filter.inline-filters h2 {
      display: none !important;
    }
    /* Primeira div dentro do form de busca com flex */
    #changelist-search > div:first-child {
      display: flex !important;
      align-items: center !important;
    }
    #changelist-filter.inline-filters details {
      position: relative;
      display: inline-block;
      margin: 0 !important;
    }
    /* Garantir que details n√£o estejam abertos por padr√£o - ul s√≥ aparece quando open */
    #changelist-filter.inline-filters details:not([open]) ul {
      display: none !important;
    }
    /* Quando open, mostrar o ul */
    #changelist-filter.inline-filters details[open] ul {
      display: block !important;
    }
    #changelist-filter.inline-filters details summary {
      font-size: 0.875rem;
      font-weight: 500;
      color: #2d3748;
      cursor: pointer;
      padding: 0.5rem 0.75rem;
      background: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      list-style: none;
    }
    #changelist-filter.inline-filters details summary::-webkit-details-marker {
      display: none;
    }
    #changelist-filter.inline-filters details summary::before {
      content: '‚ñ∂';
      display: inline-block;
      margin-right: 0.5rem;
      font-size: 0.625rem;
      opacity: 0.6;
    }
    #changelist-filter.inline-filters details[open] summary::before {
      transform: rotate(90deg);
    }
    #changelist-filter.inline-filters ul {
      position: absolute;
      z-index: 100;
      margin-top: 0.25rem;
      padding: 0.5rem;
      background: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      min-width: 200px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    /* For√ßar conte√∫do principal a ocupar 100% */
    .colMS {
      margin-right: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      float: none !important;
      box-sizing: border-box !important;
    }
    #changelist {
      width: 100% !important;
      max-width: 100% !important;
      display: block !important;
      box-sizing: border-box !important;
    }
    #changelist .changelist-form-container {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      box-sizing: border-box !important;
    }
    #changelist-form {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    #result_list {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    #changelist table {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
      table-layout: auto !important;
    }
    /* Remover qualquer margem/padding extra */
    #content-main {
      width: 100% !important;
      max-width: 100% !important;
      margin-right: 0 !important;
      padding-right: 0 !important;
      box-sizing: border-box !important;
    }
    /* Garantir que n√£o h√° float ou position que cause espa√ßo */
    #content-related,
    aside#content-related,
    div#content-related {
      display: none !important;
      width: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
      position: absolute !important;
      left: -9999px !important;
      visibility: hidden !important;
    }
    /* Garantir que toolbar e filtros ocupem 100% */
    #toolbar {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    #toolbar form {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
  </style>
{% endblock %}

{% block extrahead %}
{{ block.super }}
{{ media.js }}
<script src="{% static 'admin/js/filters.js' %}" defer></script>
<script>
/* Fechar todos os dropdowns de filtro ao carregar a p√°gina */
(function() {
  'use strict';
  
  console.log('üîç [Filters] Script iniciado');
  
  function closeAllFilterDropdowns() {
    console.log('üîç [Filters] closeAllFilterDropdowns chamado');
    
    // Fechar apenas elementos <details> dentro do container de filtros
    // E apenas uma vez ao carregar - n√£o interferir com intera√ß√µes do usu√°rio
    const filterContainer = document.getElementById('changelist-filter');
    console.log('üîç [Filters] Container encontrado:', filterContainer);
    
    if (!filterContainer) {
      console.warn('‚ö†Ô∏è [Filters] Container #changelist-filter n√£o encontrado');
      return;
    }
    
    const filterDetails = filterContainer.querySelectorAll('details');
    console.log('üîç [Filters] Encontrados', filterDetails.length, 'elementos details');
    
    filterDetails.forEach(function(details, index) {
      const wasOpen = details.hasAttribute('open');
      details.removeAttribute('open');
      console.log('üîç [Filters] Details', index, '- estava aberto:', wasOpen, '- agora:', details.hasAttribute('open'));
    });
    
    console.log('‚úÖ [Filters] Fechamento conclu√≠do');
  }
  
  // Executar apenas uma vez quando o DOM estiver pronto
  if (document.readyState === 'loading') {
    console.log('üîç [Filters] DOM ainda carregando, aguardando DOMContentLoaded');
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üîç [Filters] DOMContentLoaded disparado');
      // Executar ap√≥s um pequeno delay para garantir que o DOM est√° totalmente carregado
      setTimeout(function() {
        console.log('üîç [Filters] Executando ap√≥s timeout (DOMContentLoaded)');
        closeAllFilterDropdowns();
      }, 100);
    });
  } else {
    console.log('üîç [Filters] DOM j√° carregado, executando imediatamente');
    setTimeout(function() {
      console.log('üîç [Filters] Executando ap√≥s timeout (direto)');
      closeAllFilterDropdowns();
    }, 100);
  }
  
  // Executar tamb√©m ap√≥s um tempo maior para garantir
  setTimeout(function() {
    console.log('üîç [Filters] Executando ap√≥s delay adicional (2000ms)');
    closeAllFilterDropdowns();
  }, 2000);
})();
</script>
{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-list{% endblock %}                                           

{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=cl.opts.app_label %}">{{ cl.opts.app_config.verbose_name }}</a>                                             
&rsaquo; {{ cl.opts.verbose_name_plural|capfirst }}
</div>
{% endblock %}
{% endif %}

{% block coltype %}{% endblock %}

{% block content %}
  <div id="content-main">
    {% block object-tools %}
      <ul class="object-tools">
        {% block object-tools-items %}
          {% change_list_object_tools %}
        {% endblock %}
      </ul>
    {% endblock %}
    {% if cl.formset and cl.formset.errors %}
        <p class="errornote">
        {% blocktranslate count counter=cl.formset.total_error_count %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktranslate %}                                                                       
        </p>
        {{ cl.formset.non_form_errors }}
    {% endif %}
    <div class="module{% if cl.has_filters %} filtered{% endif %}" id="changelist">                                                                             
      <div class="changelist-form-container">
        {% block search %}
          {% search_form cl %}
        {% endblock %}
        {% comment %} Filtros movidos para dentro da busca - DEPOIS do search_form {% endcomment %}
        {% block filters %}
          {% if cl.has_filters %}
            <div id="changelist-filter" class="inline-filters" style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e2e8f0; width: 100%; display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center;">
              {% if cl.has_active_filters %}<h3 id="changelist-filter-clear" style="width: 100%; margin: 0 0 0.5rem 0; font-size: 0.75rem; font-weight: 600;">     
                <a href="{{ cl.clear_all_filters_qs }}">&#10006; {% translate "Clear all filters" %}</a>                                                          
              </h3>{% endif %}
              {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}                                                                        
            </div>
          {% endif %}
        {% endblock %}
        {% block date_hierarchy %}{% if cl.date_hierarchy %}{% date_hierarchy cl %}{% endif %}{% endblock %}                                                    

        <form id="changelist-form" method="post"{% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %} novalidate>{% csrf_token %}                                                                            
        {% if cl.formset %}
          <div>{{ cl.formset.management_form }}</div>
        {% endif %}

        {% block result_list %}
          {% if action_form and actions_on_top and cl.show_admin_actions %}{% admin_actions %}{% endif %}                                                       
          {% result_list cl %}
          {% if action_form and actions_on_bottom and cl.show_admin_actions %}{% admin_actions %}{% endif %}                                                    
        {% endblock %}
        {% block pagination %}{% pagination cl %}{% endblock %}
        </form>
      </div>
      {% comment %} Sidebar de filtros removida - agora est√£o inline {% endcomment %}
    </div>
  </div>
{% endblock %}

